<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MEDU Case Vault | SWM Medical Education</title>
<style>
  /* CSS Variables */
  :root {
    --primary: #0d47a1;
    --primary-light: #5472d3;
    --primary-dark: #002171;
    --accent: #42a5f5;
    --accent-dark: #1e88e5;
    --background-light: #f0f4ff;
    --background-dark: #121212;
    --text-light: #eee;
    --text-dark: #222;
    --shadow: rgba(0,0,0,0.2);
    --glow: #42a5f5;
    --border-radius: 10px;
    --transition: 0.3s ease;
    --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; 
    font-family: var(--font-main);
    background: var(--background-light);
    color: var(--text-dark);
    transition: background 0.5s, color 0.5s;
    overflow-x: hidden;
  }
  a {
    color: var(--accent-dark);
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
  h1, h2, h3, h4, h5 {
    margin: 0.3em 0;
  }
  button {
    cursor: pointer;
    border: none;
    background: var(--accent);
    color: white;
    padding: 0.6em 1.2em;
    font-size: 1rem;
    border-radius: var(--border-radius);
    box-shadow: 0 0 10px var(--glow);
    transition: background 0.3s ease, box-shadow 0.3s ease;
  }
  button:hover {
    background: var(--accent-dark);
    box-shadow: 0 0 20px var(--glow);
  }

  /* Dark Mode */
  body.dark {
    background: var(--background-dark);
    color: var(--text-light);
  }
  body.dark a {
    color: var(--accent);
  }
  body.dark button {
    background: var(--primary-light);
    box-shadow: 0 0 10px var(--primary-light);
  }
  body.dark button:hover {
    background: var(--primary);
    box-shadow: 0 0 20px var(--primary-light);
  }

  /* Layout */
  #app {
    display: flex;
    min-height: 100vh;
  }

  /* Sidebar navigation */
  nav#sidebar {
    width: 260px;
    background: var(--primary);
    color: white;
    display: flex;
    flex-direction: column;
    padding: 1em;
    box-shadow: 3px 0 10px var(--shadow);
    position: sticky;
    top: 0;
    height: 100vh;
  }
  nav#sidebar h2 {
    font-weight: 700;
    font-size: 1.5rem;
    margin-bottom: 1em;
    user-select: none;
  }
  nav#sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
    flex-grow: 1;
  }
  nav#sidebar ul li {
    margin: 1em 0;
  }
  nav#sidebar ul li button {
    width: 100%;
    background: transparent;
    box-shadow: none;
    text-align: left;
    padding: 0.6em 1em;
    font-size: 1.1rem;
    border-radius: 5px;
    color: white;
    transition: background 0.3s ease;
  }
  nav#sidebar ul li button:hover,
  nav#sidebar ul li button.active {
    background: var(--accent);
    color: #000;
    font-weight: 700;
    box-shadow: 0 0 10px var(--accent);
  }
  nav#sidebar footer {
    margin-top: auto;
    font-size: 0.9rem;
    opacity: 0.7;
    user-select: none;
  }

  /* Main Content */
  main#main-content {
    flex-grow: 1;
    padding: 2em 3em;
    overflow-y: auto;
    max-width: 100%;
  }

  /* Hero Section */
  #hero {
    text-align: center;
    margin-bottom: 2em;
  }
  #hero h1 {
    font-size: 3rem;
    font-weight: 900;
    letter-spacing: 0.1em;
    margin-bottom: 0.1em;
    color: var(--primary-dark);
  }
  #hero h2 {
    font-weight: 500;
    font-size: 1.6rem;
    margin-bottom: 0.5em;
    color: var(--accent-dark);
  }
  #hero p.author {
    font-style: italic;
    font-weight: 400;
    font-size: 1.1rem;
    color: var(--primary-light);
  }
  #hero button#enter-vault {
    font-size: 1.2rem;
    padding: 1em 2em;
    margin-top: 1.5em;
  }

  /* Section styling */
  section {
    margin-bottom: 3em;
  }
  section h2 {
    font-size: 2.2rem;
    margin-bottom: 0.6em;
    display: flex;
    align-items: center;
    gap: 0.5em;
  }
  section h3 {
    font-size: 1.5rem;
    margin-bottom: 0.4em;
    color: var(--primary-dark);
  }
  section p {
    line-height: 1.6;
    font-size: 1.1rem;
  }
  .divider {
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    border-radius: 3px;
    margin: 2em 0;
    box-shadow: 0 0 10px var(--glow);
  }

  /* Callout Boxes */
  .callout {
    background: var(--primary-light);
    color: white;
    padding: 1em 1.5em;
    border-radius: var(--border-radius);
    margin: 1em 0 2em 0;
    box-shadow: 0 0 15px var(--primary-light);
    font-weight: 600;
    font-size: 1.1rem;
  }
  .callout.warning {
    background: #d32f2f;
    box-shadow: 0 0 15px #d32f2f;
  }
  .callout.note {
    background: #0288d1;
    box-shadow: 0 0 15px #0288d1;
  }

  /* Table of Contents */
  #toc {
    background: var(--background-light);
    border-radius: var(--border-radius);
    padding: 1.2em 1.5em;
    margin-bottom: 2em;
    box-shadow: 0 0 10px var(--shadow);
  }
  #toc h3 {
    margin-bottom: 0.7em;
  }
  #toc ul {
    list-style: none;
    padding-left: 1em;
  }
  #toc ul li {
    margin-bottom: 0.5em;
  }
  #toc ul li a {
    color: var(--primary-dark);
    font-weight: 600;
    font-size: 1.1rem;
    transition: color 0.3s ease;
  }
  #toc ul li a:hover {
    color: var(--accent);
  }

  /* Responsive */
  @media (max-width: 960px) {
    #app {
      flex-direction: column;
    }
    nav#sidebar {
      width: 100%;
      height: auto;
      position: relative;
      box-shadow: none;
      flex-direction: row;
      overflow-x: auto;
    }
    nav#sidebar h2 {
      flex: 1 0 auto;
      font-size: 1.2rem;
      margin-right: 1em;
      padding: 0.5em 0;
    }
    nav#sidebar ul {
      flex-direction: row;
      display: flex;
      gap: 0.5em;
      overflow-x: auto;
    }
    nav#sidebar ul li {
      margin: 0;
    }
    nav#sidebar ul li button {
      padding: 0.5em 1em;
      font-size: 1rem;
      white-space: nowrap;
    }
    main#main-content {
      padding: 1em 1.5em;
    }
  }

  @media (max-width: 480px) {
    #hero h1 {
      font-size: 2rem;
    }
    #hero h2 {
      font-size: 1.2rem;
    }
    #hero button#enter-vault {
      width: 100%;
      padding: 1em;
      font-size: 1.1rem;
    }
  }

  /* Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }
  .modal-overlay.active {
    display: flex;
  }
  .modal {
    background: white;
    border-radius: var(--border-radius);
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    padding: 2em;
    box-shadow: 0 0 30px var(--shadow);
    position: relative;
  }
  body.dark .modal {
    background: #1e1e1e;
    color: var(--text-light);
  }
  .modal h2 {
    margin-top: 0;
  }
  .modal-close {
    position: absolute;
    top: 0.6em;
    right: 1em;
    font-size: 1.5rem;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--primary-dark);
    font-weight: 700;
  }
  body.dark .modal-close {
    color: var(--text-light);
  }

  /* Input and Forms */
  input[type=text], input[type=password], select, textarea {
    width: 100%;
    padding: 0.6em 1em;
    margin: 0.5em 0 1em 0;
    border-radius: var(--border-radius);
    border: 2px solid var(--primary-light);
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input[type=text]:focus, input[type=password]:focus, select:focus, textarea:focus {
    border-color: var(--accent-dark);
    outline: none;
    box-shadow: 0 0 8px var(--accent);
  }
  label {
    font-weight: 600;
  }

  /* Tables */
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 1em;
  }
  th, td {
    padding: 0.8em 1em;
    text-align: left;
    border-bottom: 1px solid var(--primary-light);
  }
  th {
    background: var(--primary);
    color: white;
  }
  body.dark table th {
    background: var(--primary-dark);
  }
  tr:hover {
    background: var(--background-light);
  }
  body.dark tr:hover {
    background: #333;
  }

  /* Smooth animations */
  .fade-in {
    animation: fadeIn 0.6s ease forwards;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px);}
    to { opacity: 1; transform: translateY(0);}
  }

  /* Glow effect */
  .glow {
    text-shadow:
      0 0 5px var(--accent),
      0 0 10px var(--accent),
      0 0 20px var(--accent);
  }

  /* Dark mode toggle button */
  #dark-mode-toggle {
    position: fixed;
    bottom: 1em;
    right: 1em;
    background: var(--primary);
    border-radius: 50%;
    width: 3.5em;
    height: 3.5em;
    box-shadow: 0 0 10px var(--glow);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.7rem;
    color: white;
    z-index: 10000;
    user-select: none;
  }
  #dark-mode-toggle:hover {
    background: var(--accent);
    box-shadow: 0 0 20px var(--glow);
  }

  /* Leaderboard Medals */
  .medal {
    display: inline-block;
    padding: 0.15em 0.6em;
    margin-left: 0.5em;
    border-radius: 1em;
    font-weight: 700;
    font-size: 0.9rem;
    color: white;
    user-select: none;
  }
  .medal.bronze {
    background: #cd7f32;
    box-shadow: 0 0 8px #cd7f32;
  }
  .medal.silver {
    background: #c0c0c0;
    color: #222;
    box-shadow: 0 0 8px #c0c0c0;
  }
  .medal.gold {
    background: #ffd700;
    color: #222;
    box-shadow: 0 0 8px #ffd700;
  }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 1em;
    margin-bottom: 1em;
  }
  .tab-btn {
    background: var(--primary-light);
    padding: 0.7em 1.5em;
    border-radius: var(--border-radius);
    color: white;
    font-weight: 700;
    box-shadow: 0 0 10px var(--primary-light);
    transition: background 0.3s ease;
  }
  .tab-btn.active {
    background: var(--accent);
    color: #000;
    box-shadow: 0 0 15px var(--accent);
  }
  .tab-btn:hover:not(.active) {
    background: var(--primary-dark);
  }
  .tab-content {
    display: none;
    animation: fadeIn 0.5s ease forwards;
  }
  .tab-content.active {
    display: block;
  }

  /* Form error messages */
  .error-msg {
    color: #d32f2f;
    font-weight: 700;
    font-size: 0.9rem;
    margin-top: -0.5em;
    margin-bottom: 1em;
  }

  /* Scrollbar styling */
  ::-webkit-scrollbar {
    width: 12px;
  }
  ::-webkit-scrollbar-track {
    background: var(--background-light);
  }
  ::-webkit-scrollbar-thumb {
    background-color: var(--primary-light);
    border-radius: 10px;
    border: 3px solid var(--background-light);
  }
  body.dark ::-webkit-scrollbar-track {
    background: var(--background-dark);
  }
  body.dark ::-webkit-scrollbar-thumb {
    background-color: var(--primary-dark);
    border: 3px solid var(--background-dark);
  }
</style>
</head>
<body>

<div id="app">
  <nav id="sidebar" aria-label="Main navigation">
    <h2>MEDU Case Vault</h2>
    <ul>
      <li><button class="nav-btn active" data-target="home" aria-current="page">🏠 Home</button></li>
      <li><button class="nav-btn" data-target="games">🎮 Games</button></li>
      <li><button class="nav-btn" data-target="shadow-cases">🕵️ Shadow Cases</button></li>
      <li><button class="nav-btn" data-target="anatomy-explorer">🧬 Anatomy Explorer</button></li>
      <li><button class="nav-btn" data-target="leaderboard">🏅 Leaderboard</button></li>
      <li><button class="nav-btn" data-target="archives">📜 Archives</button></li>
      <li><button class="nav-btn admin-only" data-target="admin-tools" style="display:none">🛠️ Admin Tools</button></li>
      <li><button class="nav-btn" data-target="about">ℹ️ About</button></li>
      <li><button id="logout-btn" style="display:none; margin-top: 2em; background:#d32f2f;">Logout</button></li>
    </ul>
    <footer>© SWM | MEDU Department</footer>
  </nav>

  <main id="main-content" tabindex="0" role="main" aria-live="polite">
    <!-- Home Section -->
    <section id="home" class="content-section active" aria-label="Home">
      <div id="hero">
        <h1 class="glow">MEDU Case Vault</h1>
        <h2>Where Medicine Meets Mystery</h2>
        <p class="author">By Luna.C.Everly | Medical Education Overseer</p>
        <button id="enter-vault">Enter Vault</button>
      </div>
      <div id="welcome-msg" style="display:none;">
        <h2>Welcome, <span id="player-name"></span>!</h2>
        <p>Explore the vault to enhance your clinical skills through engaging medical scenarios.</p>
      </div>
    </section>

    <!-- Games Section -->
    <section id="games" class="content-section" aria-label="Games" hidden>
      <h2>🎮 Interactive Games</h2>
      <div class="divider"></div>
      <article>
        <h3>🧠 Diagnosis Duel (1v1 Competitive)</h3>
        <p>Challenge a peer to diagnose the same case faster and more accurately. Build your rank from Bronze Medic to Platinum Medic.</p>
      </article>
      <article>
        <h3>🚨 ER Escape Room</h3>
        <p>Navigate through a high-pressure emergency room simulation, solve puzzles and stabilize patients before time runs out.</p>
      </article>
      <article>
        <h3>🧪 Anatomy Puzzle Match</h3>
        <p>Test your knowledge by matching anatomical parts, systems, and functions in a timed puzzle game.</p>
      </article>
      <article>
        <h3>📄 Case Creator Game</h3>
        <p>Create your own clinical cases using a guided builder and share them with the community (admin feature).</p>
      </article>
    </section>

    <!-- Shadow Cases Section -->
    <section id="shadow-cases" class="content-section" aria-label="Shadow Cases" hidden>
      <h2>🕵️ Shadow Cases & Locked Files</h2>
      <div class="divider"></div>
      <p>Some case files are redacted and require clearance. Progress through other cases to unlock restricted content.</p>
      <div id="shadow-cases-list" style="margin-top: 1em;">
        <!-- Shadow cases inserted here -->
      </div>
    </section>

    <!-- Anatomy Explorer -->
    <section id="anatomy-explorer" class="content-section" aria-label="Anatomy Explorer" hidden>
      <h2>🧬 Anatomy Explorer</h2>
      <div class="divider"></div>
      <p>Hover over organs in the interactive anatomy map to learn more or jump to related cases.</p>
      <div id="anatomy-map" style="max-width: 600px; margin: auto; cursor: pointer;">
        <!-- Inline SVG anatomy map -->
        <svg viewBox="0 0 600 600" aria-label="Human Anatomy Map" role="img" xmlns="http://www.w3.org/2000/svg" width="100%" height="auto" >
          <!-- Heart -->
          <circle cx="300" cy="250" r="40" fill="#e53935" stroke="#b71c1c" stroke-width="3" class="anatomy-organ" data-organ="Heart" tabindex="0" />
          <text x="300" y="250" fill="#fff" font-size="14" font-weight="700" text-anchor="middle" dy="5">❤️</text>
          <!-- Brain -->
          <ellipse cx="300" cy="120" rx="60" ry="40" fill="#3949ab" stroke="#1a237e" stroke-width="3" class="anatomy-organ" data-organ="Brain" tabindex="0"/>
          <text x="300" y="120" fill="#fff" font-size="14" font-weight="700" text-anchor="middle" dy="5">🧠</text>
          <!-- Lungs -->
          <rect x="230" y="200" width="60" height="100" rx="20" ry="20" fill="#29b6f6" stroke="#0288d1" stroke-width="3" class="anatomy-organ" data-organ="Left Lung" tabindex="0"/>
          <rect x="310" y="200" width="60" height="100" rx="20" ry="20" fill="#29b6f6" stroke="#0288d1" stroke-width="3" class="anatomy-organ" data-organ="Right Lung" tabindex="0"/>
          <text x="260" y="250" fill="#fff" font-size="14" font-weight="700" text-anchor="middle" dy="5">🫁</text>
          <text x="340" y="250" fill="#fff" font-size="14" font-weight="700" text-anchor="middle" dy="5">🫁</text>
          <!-- Liver -->
          <path d="M 360 350 Q 400 320 430 360 Q 400 400 350 380 Z" fill="#ef6c00" stroke="#e65100" stroke-width="3" class="anatomy-organ" data-organ="Liver" tabindex="0" />
          <text x="390" y="355" fill="#fff" font-size="14" font-weight="700" text-anchor="middle" dy="5">🍖</text>
          <!-- Kidneys -->
          <ellipse cx="230" cy="370" rx="35" ry="50" fill="#43a047" stroke="#1b5e20" stroke-width="3" class="anatomy-organ" data-organ="Left Kidney" tabindex="0"/>
          <ellipse cx="370" cy="370" rx="35" ry="50" fill="#43a047" stroke="#1b5e20" stroke-width="3" class="anatomy-organ" data-organ="Right Kidney" tabindex="0"/>
          <text x="230" y="375" fill="#fff" font-size="14" font-weight="700" text-anchor="middle" dy="5">🟩</text>
          <text x="370" y="375" fill="#fff" font-size="14" font-weight="700" text-anchor="middle" dy="5">🟩</text>
        </svg>
      </div>
    </section>

    <!-- Evidence Scanner -->
    <section id="evidence-scanner" class="content-section" aria-label="Evidence Scanner" hidden>
      <h2>🩺 Evidence Scanner</h2>
      <div class="divider"></div>
      <p>Drag and drop clinical files or images below to scan for evidence.</p>
      <div id="drop-area" tabindex="0" role="region" aria-label="Drag and drop clinical files" style="border: 2px dashed var(--primary); border-radius: var(--border-radius); padding: 3em; text-align: center; font-size: 1.2rem; color: var(--primary-dark);">
        Drop files here or click to select
        <input type="file" id="file-input" multiple style="display:none;" />
      </div>
      <div id="scan-result" style="margin-top: 1.5em; font-weight: 700; color: var(--accent-dark);"></div>
    </section>

    <!-- Case Report Generator -->
    <section id="case-report" class="content-section" aria-label="Case Report Generator" hidden>
      <h2>📄 Case Report Generator</h2>
      <div class="divider"></div>
      <p>Export a simulated case report after solving a case.</p>
      <form id="report-form" style="max-width: 600px; margin: auto;">
        <label for="report-name">Name:</label>
        <input type="text" id="report-name" name="report-name" required placeholder="Your full name" />

        <label for="report-badge">Badge:</label>
        <input type="text" id="report-badge" name="report-badge" required placeholder="Your badge ID" />

        <label for="report-rank">Rank:</label>
        <select id="report-rank" name="report-rank" required>
          <option value="">Select rank</option>
          <option value="Bronze Medic">Bronze Medic</option>
          <option value="Silver Medic">Silver Medic</option>
          <option value="Gold Medic">Gold Medic</option>
          <option value="Platinum Medic">Platinum Medic</option>
        </select>

        <label for="report-case">Case Solved:</label>
        <input type="text" id="report-case" name="report-case" required placeholder="Case name or ID" />

        <button type="submit">Generate Report</button>
      </form>
      <div id="generated-report" style="margin-top: 2em; border: 2px solid var(--primary); padding: 1em; border-radius: var(--border-radius); display:none; white-space: pre-wrap; background: var(--background-light); color: var(--text-dark);"></div>
    </section>

    <!-- Leaderboard -->
    <section id="leaderboard" class="content-section" aria-label="Leaderboard" hidden>
      <h2>🏅 Leaderboard</h2>
      <div class="divider"></div>
      <table aria-describedby="leaderboard-desc">
        <caption id="leaderboard-desc" class="sr-only">Ranking of players by completed cases and medals earned</caption>
        <thead>
          <tr>
            <th>Rank</th>
            <th>Player</th>
            <th>Completed Cases</th>
            <th>Medals</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body">
          <!-- Leaderboard data here -->
        </tbody>
      </table>
    </section>

    <!-- Archives -->
    <section id="archives" class="content-section" aria-label="Archives" hidden>
      <h2>📜 Archives</h2>
      <div class="divider"></div>
      <p>Explore the storied history of the Medical Education Department through a timeline of legendary cases.</p>
      <ol id="archives-timeline" style="max-width: 700px; margin: auto;">
        <!-- Timeline entries here -->
      </ol>
    </section>

    <!-- Admin Tools -->
    <section id="admin-tools" class="content-section" aria-label="Admin Tools" hidden>
      <h2>🛠️ Admin Tools</h2>
      <div class="divider"></div>

      <div id="admin-login-container">
        <h3>Admin Login</h3>
        <form id="admin-login-form">
          <label for="admin-username">Username:</label>
          <input type="text" id="admin-username" required autocomplete="off" />
          <label for="admin-password">Password:</label>
          <input type="password" id="admin-password" required autocomplete="off" />
          <button type="submit">Log In</button>
          <p id="admin-login-error" class="error-msg" aria-live="assertive" style="display:none;"></p>
        </form>
      </div>

      <div id="admin-panel" style="display:none;">
        <nav class="tabs" role="tablist" aria-label="Admin Sections">
          <button class="tab-btn active" role="tab" aria-selected="true" aria-controls="tab-cases" id="tab-btn-cases">Manage Cases</button>
          <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-members" id="tab-btn-members">Manage Members</button>
          <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-stats" id="tab-btn-stats">View User Stats</button>
        </nav>
        <div id="tab-cases" class="tab-content active" role="tabpanel" aria-labelledby="tab-btn-cases">
          <h3>Submit New Case</h3>
          <form id="case-submit-form">
            <label for="case-title">Case Title:</label>
            <input type="text" id="case-title" required />
            <label for="case-description">Description:</label>
            <textarea id="case-description" rows="4" required></textarea>
            <label for="case-type">Type:</label>
            <select id="case-type" required>
              <option value="">Select type</option>
              <option value="Diagnosis Duel">Diagnosis Duel</option>
              <option value="ER Escape Room">ER Escape Room</option>
              <option value="Anatomy Puzzle Match">Anatomy Puzzle Match</option>
              <option value="Case Creator">Case Creator</option>
              <option value="Shadow Case">Shadow Case (Locked)</option>
            </select>
            <label for="case-status">Status:</label>
            <select id="case-status" required>
              <option value="Open">Open</option>
              <option value="Solved">Solved</option>
              <option value="Archived">Archived</option>
            </select>
            <button type="submit">Add Case</button>
          </form>
          <h4 style="margin-top:2em;">Existing Cases</h4>
          <table id="admin-cases-table" style="width:100%; max-width: 900px;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Admin cases list -->
            </tbody>
          </table>
        </div>

        <div id="tab-members" class="tab-content" role="tabpanel" aria-labelledby="tab-btn-members" hidden>
          <h3>Add New Member</h3>
          <form id="member-add-form">
            <label for="member-name">Member Name:</label>
            <input type="text" id="member-name" required />
            <label for="member-rank">Rank:</label>
            <select id="member-rank" required>
              <option value="">Select rank</option>
              <option value="Bronze Medic">Bronze Medic</option>
              <option value="Silver Medic">Silver Medic</option>
              <option value="Gold Medic">Gold Medic</option>
            </select>
            <button type="submit">Add Member</button>
          </form>
          <h4 style="margin-top:2em;">Current Members</h4>
          <table id="admin-members-table" style="width:100%; max-width: 900px;">
            <thead>
              <tr>
                <th>Name</th>
                <th>Rank</th>
                <th>Cases Completed</th>
                <th>Medals</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Admin members list -->
            </tbody>
          </table>
        </div>

        <div id="tab-stats" class="tab-content" role="tabpanel" aria-labelledby="tab-btn-stats" hidden>
          <h3>User Statistics</h3>
          <p>Stats display for educational purposes (simulated data).</p>
          <table id="admin-stats-table" style="width:100%; max-width: 900px;">
            <thead>
              <tr>
                <th>Player</th>
                <th>Cases Solved</th>
                <th>Rank</th>
                <th>Medals Earned</th>
              </tr>
            </thead>
            <tbody>
              <!-- Stats data -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="content-section" aria-label="About" hidden>
      <h2>ℹ️ About MEDU Case Vault</h2>
      <p>
        The MEDU Case Vault is a cutting-edge simulation and education platform created for the
        SWM Medical Education Department. Developed by Luna.C.Everly, it offers immersive,
        gamified medical training to sharpen clinical skills and foster teamwork.
      </p>
      <p>
        This platform leverages smooth UI, glowing effects, and interactive modules designed
        to engage students and professionals alike in realistic medical scenarios.
      </p>
      <p>
        All code is open-source, frontend-only, and optimized for seamless deployment on GitHub Pages.
      </p>
      <p>Stay curious. Stay sharp. Welcome to the future of medical learning.</p>
    </section>
  </main>
</div>

<button id="dark-mode-toggle" aria-label="Toggle dark mode">🌙</button>

<!-- Modal Template -->
<div class="modal-overlay" id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1">
  <div class="modal" role="document">
    <button class="modal-close" aria-label="Close modal">&times;</button>
    <h2 id="modal-title">Modal Title</h2>
    <div id="modal-content"></div>
  </div>
</div>

<script>
(() => {
  "use strict";

  /* App State */
  let currentUser = null;
  let isAdminLoggedIn = false;
  let cases = [];
  let members = [];
  let caseIdCounter = 1;

  /* Cached DOM */
  const navButtons = document.querySelectorAll(".nav-btn");
  const contentSections = document.querySelectorAll(".content-section");
  const enterVaultBtn = document.getElementById("enter-vault");
  const welcomeMsg = document.getElementById("welcome-msg");
  const playerNameSpan = document.getElementById("player-name");
  const logoutBtn = document.getElementById("logout-btn");
  const adminBtn = document.querySelector(".admin-only");
  const darkModeToggle = document.getElementById("dark-mode-toggle");
  const modalOverlay = document.getElementById("modal");
  const modalCloseBtn = modalOverlay.querySelector(".modal-close");
  const modalTitle = modalOverlay.querySelector("#modal-title");
  const modalContent = modalOverlay.querySelector("#modal-content");

  /* Sections */
  const homeSection = document.getElementById("home");
  const gamesSection = document.getElementById("games");
  const shadowCasesSection = document.getElementById("shadow-cases");
  const anatomyExplorerSection = document.getElementById("anatomy-explorer");
  const evidenceScannerSection = document.getElementById("evidence-scanner");
  const caseReportSection = document.getElementById("case-report");
  const leaderboardSection = document.getElementById("leaderboard");
  const archivesSection = document.getElementById("archives");
  const adminToolsSection = document.getElementById("admin-tools");
  const aboutSection = document.getElementById("about");

  /* Admin Login Elements */
  const adminLoginContainer = document.getElementById("admin-login-container");
  const adminLoginForm = document.getElementById("admin-login-form");
  const adminLoginError = document.getElementById("admin-login-error");
  const adminPanel = document.getElementById("admin-panel");
  const adminCasesTableBody = document.querySelector("#admin-cases-table tbody");
  const adminMembersTableBody = document.querySelector("#admin-members-table tbody");
  const adminStatsTableBody = document.querySelector("#admin-stats-table tbody");

  /* Admin Tabs */
  const adminTabButtons = adminPanel ? adminPanel.querySelectorAll(".tab-btn") : [];
  const adminTabContents = adminPanel ? adminPanel.querySelectorAll(".tab-content") : [];

  /* Other Elements */
  const shadowCasesList = document.getElementById("shadow-cases-list");
  const anatomyMap = document.getElementById("anatomy-map");
  const dropArea = document.getElementById("drop-area");
  const fileInput = document.getElementById("file-input");
  const scanResult = document.getElementById("scan-result");
  const reportForm = document.getElementById("report-form");
  const generatedReport = document.getElementById("generated-report");
  const leaderboardBody = document.getElementById("leaderboard-body");
  const archivesTimeline = document.getElementById("archives-timeline");

  const memberAddForm = document.getElementById("member-add-form");
  const caseSubmitForm = document.getElementById("case-submit-form");

  /* Constants */
  const ADMIN_USERNAME = "admin";
  const ADMIN_PASSWORD = "password123";

  /* Helper Functions */

  // Save data to localStorage
  function saveData() {
    localStorage.setItem("meduCases", JSON.stringify(cases));
    localStorage.setItem("meduMembers", JSON.stringify(members));
  }

  // Load data from localStorage
  function loadData() {
    const loadedCases = JSON.parse(localStorage.getItem("meduCases"));
    const loadedMembers = JSON.parse(localStorage.getItem("meduMembers"));
    if (Array.isArray(loadedCases)) {
      cases = loadedCases;
      caseIdCounter = cases.reduce((maxId, c) => c.id > maxId ? c.id : maxId, 0) + 1;
    }
    if (Array.isArray(loadedMembers)) {
      members = loadedMembers;
    }
  }

  // Show modal
  function showModal(title, contentHTML) {
    modalTitle.textContent = title;
    modalContent.innerHTML = contentHTML;
    modalOverlay.classList.add("active");
    modalOverlay.focus();
  }

  // Close modal
  function closeModal() {
    modalOverlay.classList.remove("active");
    modalContent.innerHTML = "";
  }

  // Sanitize text for HTML insertion
  function sanitizeText(str) {
    return str.replace(/[&<>"']/g, (m) => {
      switch(m) {
        case "&": return "&amp;";
        case "<": return "&lt;";
        case ">": return "&gt;";
        case '"': return "&quot;";
        case "'": return "&#39;";
        default: return m;
      }
    });
  }

  // Display sections based on navigation
  function displaySection(targetId) {
    contentSections.forEach(sec => {
      if (sec.id === targetId) {
        sec.hidden = false;
        sec.classList.add("active");
      } else {
        sec.hidden = true;
        sec.classList.remove("active");
      }
    });
  }

  // Switch nav button active state
  function setActiveNavButton(targetBtn) {
    navButtons.forEach(btn => {
      if (btn === targetBtn) {
        btn.classList.add("active");
        btn.setAttribute("aria-current", "page");
      } else {
        btn.classList.remove("active");
        btn.removeAttribute("aria-current");
      }
    });
  }

  // Render shadow cases list
  function renderShadowCases() {
    if (!shadowCasesList) return;
    const shadowCases = cases.filter(c => c.type === "Shadow Case");
    if (shadowCases.length === 0) {
      shadowCasesList.innerHTML = "<p>No shadow cases available currently.</p>";
      return;
    }
    shadowCasesList.innerHTML = "";
    shadowCases.forEach(c => {
      const div = document.createElement("div");
      div.className = "callout warning";
      div.tabIndex = 0;
      div.textContent = `${c.title} - Status: ${c.status}`;
      shadowCasesList.appendChild(div);
    });
  }

  // Render anatomy tooltip content on organ hover/click
  function setupAnatomyMap() {
    if (!anatomyMap) return;
    anatomyMap.querySelectorAll(".anatomy-organ").forEach(elem => {
      elem.addEventListener("mouseenter", () => {
        const organ = elem.getAttribute("data-organ");
        showModal(`${organ}`, `<p><strong>${organ}</strong> is a vital anatomical structure with clinical significance.</p><p>Explore related cases in the vault.</p>`);
      });
      elem.addEventListener("mouseleave", closeModal);
      elem.addEventListener("focus", () => {
        const organ = elem.getAttribute("data-organ");
        showModal(`${organ}`, `<p><strong>${organ}</strong> is a vital anatomical structure with clinical significance.</p><p>Explore related cases in the vault.</p>`);
      });
      elem.addEventListener("blur", closeModal);
      elem.addEventListener("click", () => {
        const organ = elem.getAttribute("data-organ");
        showModal(`${organ}`, `<p>You clicked on <strong>${organ}</strong>. Use the Games section to find cases related to this organ.</p>`);
      });
    });
  }

  // Drag and drop file scanning simulation
  function setupFileDrop() {
    if (!dropArea || !fileInput) return;

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ["dragenter", "dragover", "dragleave", "drop"].forEach(eventName => {
      dropArea.addEventListener(eventName, preventDefaults, false);
    });

    dropArea.addEventListener("drop", (e) => {
      const dt = e.dataTransfer;
      const files = dt.files;
      handleFiles(files);
    });

    dropArea.addEventListener("click", () => {
      fileInput.click();
    });

    fileInput.addEventListener("change", () => {
      handleFiles(fileInput.files);
    });

    function handleFiles(files) {
      if (files.length === 0) {
        scanResult.textContent = "No files selected.";
        return;
      }
      scanResult.textContent = "Scanning files...";
      setTimeout(() => {
        scanResult.textContent = `Scan complete: ${files.length} file(s) scanned. No abnormalities detected.`;
      }, 2000);
    }
  }

  // Generate case report from form
  function setupReportGenerator() {
    if (!reportForm) return;

    reportForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = sanitizeText(reportForm["report-name"].value.trim());
      const badge = sanitizeText(reportForm["report-badge"].value.trim());
      const rank = sanitizeText(reportForm["report-rank"].value);
      const caseSolved = sanitizeText(reportForm["report-case"].value.trim());
      if (!name || !badge || !rank || !caseSolved) return;

      const date = new Date().toLocaleDateString();
      const report = `
Case Report
-----------
Date: ${date}
Name: ${name}
Badge: ${badge}
Rank: ${rank}

Case Solved: ${caseSolved}

Summary:
The above case was successfully diagnosed and managed according to MEDU protocols. All procedures and documentation are compliant with department standards.

Signature: ___________________________

`;
      generatedReport.style.display = "block";
      generatedReport.textContent = report;
    });
  }

  // Render leaderboard data
  function renderLeaderboard() {
    if (!leaderboardBody) return;
    if (members.length === 0) {
      leaderboardBody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No members available</td></tr>`;
      return;
    }
    // Sort members by cases completed descending
    const sortedMembers = [...members].sort((a,b) => b.casesCompleted - a.casesCompleted);
    leaderboardBody.innerHTML = "";
    sortedMembers.forEach((m, i) => {
      const tr = document.createElement("tr");
      const medalClass = m.rank.toLowerCase().includes("bronze") ? "bronze" : m.rank.toLowerCase().includes("silver") ? "silver" : m.rank.toLowerCase().includes("gold") ? "gold" : "";
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${sanitizeText(m.name)}</td>
        <td>${m.casesCompleted}</td>
        <td><span class="medal ${medalClass}">${sanitizeText(m.rank)}</span></td>
      `;
      leaderboardBody.appendChild(tr);
    });
  }

  // Render archives timeline
  function renderArchives() {
    if (!archivesTimeline) return;
    const timelineEntries = [
      {year: 2015, event: "MEDU Case Vault project initiated by Luna.C.Everly."},
      {year: 2016, event: "First prototype with diagnosis duel game launched."},
      {year: 2017, event: "ER Escape Room feature integrated."},
      {year: 2018, event: "Anatomy Explorer with interactive SVG map released."},
      {year: 2019, event: "Evidence Scanner drag/drop simulation implemented."},
      {year: 2020, event: "Case Report Generator added."},
      {year: 2021, event: "Full admin tools with login and case management deployed."},
      {year: 2022, event: "Leaderboard and gamification medals introduced."},
      {year: 2023, event: "Dark mode and accessibility improvements rolled out."}
    ];
    archivesTimeline.innerHTML = timelineEntries.map(entry =>
      `<li><strong>${entry.year}</strong>: ${entry.event}</li>`).join("");
  }

  // Admin login handler
  function adminLogin(e) {
    e.preventDefault();
    const username = e.target["admin-username"].value.trim();
    const password = e.target["admin-password"].value.trim();
    if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
      isAdminLoggedIn = true;
      adminLoginError.style.display = "none";
      adminLoginContainer.style.display = "none";
      adminPanel.style.display = "block";
      adminBtn.style.display = "inline-block";
      logoutBtn.style.display = "inline-block";
      alert("Admin login successful. Admin Tools unlocked.");
      renderAdminCases();
      renderAdminMembers();
      renderAdminStats();
    } else {
      adminLoginError.textContent = "Invalid username or password.";
      adminLoginError.style.display = "block";
    }
  }

  // Admin logout handler
  function adminLogout() {
    isAdminLoggedIn = false;
    adminLoginContainer.style.display = "block";
    adminPanel.style.display = "none";
    adminBtn.style.display = "none";
    logoutBtn.style.display = "none";
    alert("Logged out of admin.");
    // Return to home
    setActiveNavButton(navButtons[0]);
    displaySection("home");
  }

  // Add new case from admin form
  function addNewCase(e) {
    e.preventDefault();
    const title = caseSubmitForm["case-title"].value.trim();
    const description = caseSubmitForm["case-description"].value.trim();
    const type = caseSubmitForm["case-type"].value;
    const status = caseSubmitForm["case-status"].value;
    if (!title || !description || !type || !status) return alert("Fill all fields");

    const newCase = {
      id: caseIdCounter++,
      title,
      description,
      type,
      status
    };
    cases.push(newCase);
    saveData();
    renderAdminCases();
    renderShadowCases();
    alert(`Case "${title}" added successfully.`);
    caseSubmitForm.reset();
  }

  // Render admin cases table
  function renderAdminCases() {
    if (!adminCasesTableBody) return;
    if (cases.length === 0) {
      adminCasesTableBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No cases added yet.</td></tr>`;
      return;
    }
    adminCasesTableBody.innerHTML = "";
    cases.forEach(c => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${c.id}</td>
        <td>${sanitizeText(c.title)}</td>
        <td>${sanitizeText(c.type)}</td>
        <td>${sanitizeText(c.status)}</td>
        <td>
          <button class="btn-edit-case" data-id="${c.id}" aria-label="Edit case ${c.title}">✏️</button>
          <button class="btn-delete-case" data-id="${c.id}" aria-label="Delete case ${c.title}">🗑️</button>
        </td>
      `;
      adminCasesTableBody.appendChild(tr);
    });

    // Add event listeners for edit and delete buttons
    document.querySelectorAll(".btn-edit-case").forEach(btn => {
      btn.onclick = () => {
        const id = Number(btn.getAttribute("data-id"));
        openEditCaseModal(id);
      };
    });
    document.querySelectorAll(".btn-delete-case").forEach(btn => {
      btn.onclick = () => {
        const id = Number(btn.getAttribute("data-id"));
        if (confirm("Delete this case permanently?")) {
          cases = cases.filter(c => c.id !== id);
          saveData();
          renderAdminCases();
          renderShadowCases();
        }
      };
    });
  }

  // Open modal for editing case
  function openEditCaseModal(caseId) {
    const c = cases.find(c => c.id === caseId);
    if (!c) return;
    const contentHTML = `
      <form id="edit-case-form">
        <label for="edit-case-title">Title:</label>
        <input type="text" id="edit-case-title" name="edit-case-title" value="${sanitizeText(c.title)}" required />
        <label for="edit-case-description">Description:</label>
        <textarea id="edit-case-description" name="edit-case-description" rows="4" required>${sanitizeText(c.description)}</textarea>
        <label for="edit-case-type">Type:</label>
        <select id="edit-case-type" name="edit-case-type" required>
          <option value="Diagnosis Duel" ${c.type === "Diagnosis Duel" ? "selected" : ""}>Diagnosis Duel</option>
          <option value="ER Escape Room" ${c.type === "ER Escape Room" ? "selected" : ""}>ER Escape Room</option>
          <option value="Anatomy Puzzle Match" ${c.type === "Anatomy Puzzle Match" ? "selected" : ""}>Anatomy Puzzle Match</option>
          <option value="Case Creator" ${c.type === "Case Creator" ? "selected" : ""}>Case Creator</option>
          <option value="Shadow Case" ${c.type === "Shadow Case" ? "selected" : ""}>Shadow Case</option>
        </select>
        <label for="edit-case-status">Status:</label>
        <select id="edit-case-status" name="edit-case-status" required>
          <option value="Open" ${c.status === "Open" ? "selected" : ""}>Open</option>
          <option value="Solved" ${c.status === "Solved" ? "selected" : ""}>Solved</option>
          <option value="Archived" ${c.status === "Archived" ? "selected" : ""}>Archived</option>
        </select>
        <button type="submit">Save Changes</button>
      </form>
    `;
    showModal("Edit Case", contentHTML);

    const editCaseForm = document.getElementById("edit-case-form");
    editCaseForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const updatedTitle = editCaseForm["edit-case-title"].value.trim();
      const updatedDescription = editCaseForm["edit-case-description"].value.trim();
      const updatedType = editCaseForm["edit-case-type"].value;
      const updatedStatus = editCaseForm["edit-case-status"].value;
      if (!updatedTitle || !updatedDescription || !updatedType || !updatedStatus) return alert("Fill all fields");

      c.title = updatedTitle;
      c.description = updatedDescription;
      c.type = updatedType;
      c.status = updatedStatus;
      saveData();
      renderAdminCases();
      renderShadowCases();
      closeModal();
    });
  }

  // Render admin members table
  function renderAdminMembers() {
    if (!adminMembersTableBody) return;
    if (members.length === 0) {
      adminMembersTableBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No members added yet.</td></tr>`;
      return;
    }
    adminMembersTableBody.innerHTML = "";
    members.forEach((m, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${sanitizeText(m.name)}</td>
        <td>${sanitizeText(m.rank)}</td>
        <td>${m.casesCompleted}</td>
        <td><span class="medal">${sanitizeText(m.rank)}</span></td>
        <td>
          <button class="btn-delete-member" data-index="${i}" aria-label="Delete member ${m.name}">🗑️</button>
        </td>
      `;
      adminMembersTableBody.appendChild(tr);
    });

    // Add event listeners for delete member buttons
    document.querySelectorAll(".btn-delete-member").forEach(btn => {
      btn.onclick = () => {
        const idx = Number(btn.getAttribute("data-index"));
        if (confirm("Delete this member permanently?")) {
          members.splice(idx, 1);
          saveData();
          renderAdminMembers();
          renderLeaderboard();
        }
      };
    });
  }

  // Add new member from form
  function addNewMember(e) {
    e.preventDefault();
    const name = memberAddForm["member-name"].value.trim();
    const rank = memberAddForm["member-rank"].value;
    if (!name || !rank) return alert("Fill all fields");
    members.push({ name, rank, casesCompleted: 0, medals: 0 });
    saveData();
    renderAdminMembers();
    renderLeaderboard();
    memberAddForm.reset();
    alert(`Member "${name}" added successfully.`);
  }

  // Render admin stats
  function renderAdminStats() {
    if (!adminStatsTableBody) return;
    if (members.length === 0) {
      adminStatsTableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No data available.</td></tr>`;
      return;
    }
    adminStatsTableBody.innerHTML = "";
    members.forEach(m => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${sanitizeText(m.name)}</td>
        <td>${m.casesCompleted}</td>
        <td>${sanitizeText(m.rank)}</td>
        <td>${m.medals}</td>
      `;
      adminStatsTableBody.appendChild(tr);
    });
  }

  /* Event Listeners */

  // Navigation buttons
  navButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      setActiveNavButton(btn);
      displaySection(btn.dataset.target);
    });
  });

  // Enter Vault Button (login simulation)
  if (enterVaultBtn) {
    enterVaultBtn.addEventListener("click", () => {
      currentUser = prompt("Enter your name to start:");
      if (currentUser) {
        welcomeMsg.textContent = `Welcome, ${currentUser}!`;
        playerNameSpan.textContent = currentUser;
        enterVaultBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        setActiveNavButton(navButtons[1]);
        displaySection("games");
      }
    });
  }

  // Logout button
  if (logoutBtn) {
    logoutBtn.addEventListener("click", () => {
      currentUser = null;
      welcomeMsg.textContent = "";
      playerNameSpan.textContent = "";
      logoutBtn.style.display = "none";
      enterVaultBtn.style.display = "inline-block";
      setActiveNavButton(navButtons[0]);
      displaySection("home");
    });
  }

  // Admin login form
  if (adminLoginForm) {
    adminLoginForm.addEventListener("submit", adminLogin);
  }

  // Admin logout button
  if (logoutBtn) {
    logoutBtn.addEventListener("click", () => {
      if (isAdminLoggedIn) adminLogout();
    });
  }

  // Case submit form
  if (caseSubmitForm) {
    caseSubmitForm.addEventListener("submit", addNewCase);
  }

  // Member add form
  if (memberAddForm) {
    memberAddForm.addEventListener("submit", addNewMember);
  }

  // Dark mode toggle
  if (darkModeToggle) {
    darkModeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      darkModeToggle.textContent = document.body.classList.contains("dark-mode") ? "☀️" : "🌙";
    });
  }

  // Modal close button
  if (modalCloseBtn) {
    modalCloseBtn.addEventListener("click", closeModal);
  }

  // Modal overlay click to close
  modalOverlay.addEventListener("click", (e) => {
    if (e.target === modalOverlay) closeModal();
  });

  // Setup anatomy map interactivity
  setupAnatomyMap();

  // Setup file drop scanning
  setupFileDrop();

  // Setup report generator
  setupReportGenerator();

  // Load initial data and render UI
  loadData();
  renderShadowCases();
  renderLeaderboard();
  renderArchives();

  // Set initial active section
  setActiveNavButton(navButtons[0]);
  displaySection("home");

  // Admin tab switching
  adminTabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      adminTabButtons.forEach(b => {
        b.classList.remove("active");
        b.setAttribute("aria-selected", "false");
      });
      btn.classList.add("active");
      btn.setAttribute("aria-selected", "true");

      adminTabContents.forEach(content => {
        content.hidden = true;
        content.classList.remove("active");
      });

      const target = btn.getAttribute("aria-controls");
      const targetContent = document.getElementById(target);
      if (targetContent) {
        targetContent.hidden = false;
        targetContent.classList.add("active");
      }
    });
  });
})();
</script>
</body>
</html>
