<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEDU Case Vault | SWM Medical Education</title>
  <style>
    /*
      MEDU Case Vault
      Author: Luna.C.Everly | Medical Education Overseer
      Theme: Medical, high-tech, immersive UI with blue shades and smooth gradients.
      Fully responsive, modern, gamified UI/UX.
    */

    /* CSS Variables */
    :root {
      --primary-dark: #0d1b2a;
      --primary-light: #1b2e4b;
      --accent-blue: #3a9bff;
      --accent-blue-light: #61b7ff;
      --background-light: #e9f0ff;
      --background-dark: #071322;
      --text-light: #eef3f9;
      --text-dark: #1b2e4b;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --font-primary: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      --transition-speed: 0.3s;
      --shadow-glow: 0 0 10px var(--accent-blue-light);
      --border-radius: 10px;
    }

    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    html, body {
      height: 100%;
      font-family: var(--font-primary);
      background: var(--primary-dark);
      color: var(--text-light);
      overflow-x: hidden;
    }

    a {
      color: var(--accent-blue);
      text-decoration: none;
      transition: color var(--transition-speed);
    }
    a:hover {
      color: var(--accent-blue-light);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
    }
    ::-webkit-scrollbar-track {
      background: var(--primary-dark);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--accent-blue);
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-blue-light);
    }

    /* Container */
    #app {
      display: flex;
      flex-direction: row;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar Navigation */
    nav.sidebar {
      width: 280px;
      background: var(--primary-light);
      padding: 2rem 1.5rem;
      box-shadow: 2px 0 8px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      position: relative;
      transition: transform 0.3s ease-in-out;
    }

    nav.sidebar.hide {
      transform: translateX(-100%);
    }

    nav.sidebar h1 {
      font-weight: 700;
      font-size: 1.8rem;
      color: var(--text-light);
      margin-bottom: 1rem;
      text-align: center;
      user-select: text;
      letter-spacing: 0.05em;
    }

    nav.sidebar .author {
      font-size: 0.85rem;
      font-style: italic;
      color: var(--accent-blue-light);
      margin-bottom: 2rem;
      text-align: center;
    }

    nav.sidebar ul {
      list-style: none;
      flex-grow: 1;
    }

    nav.sidebar ul li {
      margin-bottom: 1rem;
    }

    nav.sidebar ul li a {
      display: flex;
      align-items: center;
      font-size: 1.1rem;
      color: var(--text-light);
      padding: 0.75rem 1rem;
      border-radius: var(--border-radius);
      transition: background var(--transition-speed);
      cursor: pointer;
      user-select: text;
    }

    nav.sidebar ul li a span.icon {
      margin-right: 1rem;
      font-size: 1.4rem;
      width: 28px;
      text-align: center;
    }

    nav.sidebar ul li a:hover,
    nav.sidebar ul li a.active {
      background: var(--accent-blue);
      box-shadow: var(--shadow-glow);
      color: var(--text-light);
    }

    nav.sidebar .toggle-btn {
      position: absolute;
      top: 1rem;
      right: -2.5rem;
      background: var(--primary-light);
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 10px var(--accent-blue);
      transition: background var(--transition-speed);
      user-select: none;
    }

    nav.sidebar .toggle-btn:hover {
      background: var(--accent-blue);
    }

    /* Main Content Area */
    main.content-area {
      flex-grow: 1;
      background: var(--background-dark);
      color: var(--text-light);
      padding: 2rem 3rem;
      overflow-y: auto;
      scroll-behavior: smooth;
      display: flex;
      flex-direction: column;
    }

    main.content-area h2.section-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent-blue);
      margin-bottom: 1rem;
      user-select: text;
      text-shadow: 0 0 8px var(--accent-blue-light);
    }

    main.content-area h3.sub-title {
      font-size: 1.8rem;
      margin-top: 2rem;
      margin-bottom: 0.75rem;
      color: var(--accent-blue-light);
      user-select: text;
    }

    main.content-area p,
    main.content-area li {
      font-size: 1.05rem;
      line-height: 1.6;
      margin-bottom: 1rem;
      color: #d8e3f0;
      user-select: text;
    }

    main.content-area ul {
      padding-left: 1.2rem;
      margin-bottom: 1rem;
    }

    /* Buttons */
    button {
      background: var(--accent-blue);
      color: var(--text-light);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--border-radius);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 0 8px var(--accent-blue-light);
      transition: background var(--transition-speed), box-shadow var(--transition-speed);
      user-select: none;
    }
    button:hover {
      background: var(--accent-blue-light);
      box-shadow: 0 0 12px var(--accent-blue);
    }

    /* Cards and Boxes */
    .card {
      background: var(--primary-light);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 0 12px rgba(0,0,0,0.7);
      user-select: text;
      transition: box-shadow var(--transition-speed);
    }
    .card:hover {
      box-shadow: 0 0 20px var(--accent-blue-light);
    }

    /* Highlighted Callout Boxes */
    .callout {
      border-left: 5px solid var(--accent-blue);
      background: rgba(58, 155, 255, 0.15);
      padding: 1rem 1.5rem;
      margin: 1rem 0 2rem 0;
      border-radius: var(--border-radius);
      font-style: italic;
      color: #c6d9ff;
      user-select: text;
      box-shadow: inset 0 0 10px var(--accent-blue-light);
      transition: background var(--transition-speed);
    }
    .callout.warning {
      border-left-color: var(--danger);
      background: rgba(220, 53, 69, 0.15);
      color: #f9a3a6;
      box-shadow: inset 0 0 10px var(--danger);
    }

    /* Section Dividers */
    .divider {
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-blue-light));
      margin: 3rem 0;
      border-radius: 3px;
      box-shadow: 0 0 10px var(--accent-blue-light);
    }

    /* Leaderboard Table */
    table.leaderboard {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    table.leaderboard th, table.leaderboard td {
      padding: 0.75rem 1rem;
      border: 1px solid var(--accent-blue);
      text-align: center;
      color: var(--text-light);
      user-select: text;
    }
    table.leaderboard th {
      background: var(--accent-blue);
      text-shadow: 0 0 5px var(--accent-blue-light);
      font-weight: 700;
    }
    table.leaderboard tr:nth-child(even) {
      background: rgba(58, 155, 255, 0.15);
    }

    /* Forms */
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      max-width: 500px;
    }
    form label {
      font-weight: 600;
      color: var(--accent-blue-light);
      user-select: text;
    }
    form input[type="text"],
    form input[type="password"],
    form select,
    form textarea {
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius);
      border: 2px solid var(--accent-blue);
      font-size: 1rem;
      color: var(--primary-dark);
      transition: border-color var(--transition-speed);
    }
    form input[type="text"]:focus,
    form input[type="password"]:focus,
    form select:focus,
    form textarea:focus {
      outline: none;
      border-color: var(--accent-blue-light);
      box-shadow: 0 0 8px var(--accent-blue-light);
      background: #fff;
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .modal-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* Modal Content */
    .modal {
      background: var(--primary-light);
      padding: 2rem;
      border-radius: var(--border-radius);
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 25px var(--accent-blue-light);
      position: relative;
    }

    .modal h3 {
      margin-bottom: 1rem;
      color: var(--accent-blue);
    }

    .modal .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: transparent;
      border: none;
      font-size: 1.6rem;
      color: var(--accent-blue-light);
      cursor: pointer;
      transition: color 0.3s ease;
      user-select: none;
    }
    .modal .close-btn:hover {
      color: var(--accent-blue);
    }

    /* Responsive */
    @media (max-width: 900px) {
      nav.sidebar {
        position: fixed;
        z-index: 1500;
        height: 100%;
        top: 0;
        left: 0;
        transform: translateX(-100%);
      }
      nav.sidebar.show {
        transform: translateX(0);
      }
      #app {
        flex-direction: column;
      }
      main.content-area {
        padding: 1rem 1.5rem;
        overflow-y: visible;
      }
      nav.sidebar .toggle-btn {
        top: 1rem;
        right: 1rem;
      }
    }

    /* Animation for content fade */
    .fade-in {
      animation: fadeIn ease 0.5s;
      animation-iteration-count: 1;
      animation-fill-mode: forwards;
    }
    @keyframes fadeIn {
      0% {opacity: 0;}
      100% {opacity: 1;}
    }

    /* Glow pulse for medals */
    .medal-bronze {
      color: #cd7f32;
      text-shadow: 0 0 8px #cd7f32aa;
      animation: pulseGlow 3s infinite alternate;
    }
    .medal-silver {
      color: #c0c0c0;
      text-shadow: 0 0 10px #c0c0c0aa;
      animation: pulseGlow 2.5s infinite alternate;
    }
    .medal-gold {
      color: #ffd700;
      text-shadow: 0 0 14px #ffd700cc;
      animation: pulseGlow 2s infinite alternate;
    }
    @keyframes pulseGlow {
      0% { text-shadow: 0 0 6px currentColor; }
      100% { text-shadow: 0 0 18px currentColor; }
    }

    /* Tooltip */
    [data-tooltip] {
      position: relative;
      cursor: help;
    }
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      white-space: nowrap;
      top: -2.5rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent-blue);
      color: var(--text-light);
      padding: 0.3rem 0.6rem;
      border-radius: var(--border-radius);
      font-size: 0.85rem;
      box-shadow: 0 0 8px var(--accent-blue-light);
      pointer-events: none;
      user-select: none;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div id="app">

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
      <h1>MEDU Case Vault</h1>
      <div class="author">By Luna.C.Everly | Medical Education Overseer 📘</div>

      <ul>
        <li><a href="#" data-section="home" class="nav-link active"><span class="icon">🏠</span>Home</a></li>
        <li><a href="#" data-section="games" class="nav-link"><span class="icon">🎮</span>Games</a></li>
        <li><a href="#" data-section="shadowcases" class="nav-link"><span class="icon">🕵️‍♂️</span>Shadow Cases</a></li>
        <li><a href="#" data-section="anatomy" class="nav-link"><span class="icon">🧬</span>Anatomy Explorer</a></li>
        <li><a href="#" data-section="leaderboard" class="nav-link"><span class="icon">🏅</span>Leaderboard</a></li>
        <li><a href="#" data-section="archives" class="nav-link"><span class="icon">📜</span>Archives</a></li>
        <li><a href="#" data-section="admintools" class="nav-link" id="admin-tools-link" style="display:none;"><span class="icon">🔧</span>Admin Tools</a></li>
        <li><a href="#" data-section="about" class="nav-link"><span class="icon">ℹ️</span>About</a></li>
      </ul>

      <button class="toggle-btn" id="sidebarToggle" title="Toggle Sidebar">☰</button>

      <div style="margin-top:auto; padding-top:1rem; border-top: 1px solid var(--accent-blue); text-align:center;">
        <button id="darkModeToggle" title="Toggle Dark/Light Mode">🌙</button>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="content-area" id="mainContent">
      <!-- Dynamic content injected here -->
    </main>

  </div>

  <!-- Modals -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
      <button class="close-btn" id="modalCloseBtn" aria-label="Close modal">×</button>
      <div id="modalContent"></div>
    </div>
  </div>

<script>
  (() => {
    // Application state
    let currentUser = null; // {username, role: 'admin'|'player', medals: {}, rank: string, completedCases: []}
    let usersDB = {}; // Simple in-memory user database
    let casesDB = {}; // Cases DB with details, status
    let medals = ['bronze', 'silver', 'gold'];
    const ranks = ['Bronze Medic', 'Silver Medic', 'Gold Medic', 'Platinum Medic'];

    // Default initial cases (placeholders)
    casesDB = {
      'case1': {
        id: 'case1',
        title: 'Mystery Fever',
        description: 'Patient with unknown high fever, diagnose quickly!',
        game: 'Diagnosis Duel',
        status: 'open',
        createdBy: 'admin',
        difficulty: 'easy',
      },
      'case2': {
        id: 'case2',
        title: 'ER Escape: Fire Outbreak',
        description: 'Navigate through emergency cases in a virtual ER escape room.',
        game: 'ER Escape Room',
        status: 'open',
        createdBy: 'admin',
        difficulty: 'medium',
      },
      'case3': {
        id: 'case3',
        title: 'Anatomy Match Challenge',
        description: 'Match organs to their functions and diagnose anatomy puzzles.',
        game: 'Anatomy Puzzle Match',
        status: 'open',
        createdBy: 'admin',
        difficulty: 'medium',
      },
      'case4': {
        id: 'case4',
        title: 'Case Creator Master',
        description: 'Create your own medical cases and challenge others.',
        game: 'Case Creator Game',
        status: 'open',
        createdBy: 'admin',
        difficulty: 'hard',
      },
    };

    // Simulate saved user for demo
    usersDB['admin'] = {
      username: 'admin',
      password: 'admin123',
      role: 'admin',
      medals: {bronze: 0, silver: 0, gold: 0},
      rank: 'Platinum Medic',
      completedCases: [],
    };

    // Elements
    const app = document.getElementById('app');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalContent = document.getElementById('modalContent');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    const adminToolsLink = document.getElementById('admin-tools-link');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const sidebarToggle = document.getElementById('sidebarToggle');

    // State
    let currentSection = 'home';

    // Utility Functions
    function $(selector, scope=document) {
      return scope.querySelector(selector);
    }
    function $all(selector, scope=document) {
      return Array.from(scope.querySelectorAll(selector));
    }

    // Show Modal
    function showModal(html) {
      modalContent.innerHTML = html;
      modalOverlay.classList.add('active');
      modalOverlay.focus();
    }

    // Close Modal
    function closeModal() {
      modalOverlay.classList.remove('active');
      modalContent.innerHTML = '';
    }
    modalCloseBtn.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', (e) => {
      if (e.target === modalOverlay) closeModal();
    });

    // Save/load from localStorage
    function saveToStorage() {
      localStorage.setItem('medu-users', JSON.stringify(usersDB));
      localStorage.setItem('medu-cases', JSON.stringify(casesDB));
      localStorage.setItem('medu-current-user', JSON.stringify(currentUser));
    }
    function loadFromStorage() {
      const users = localStorage.getItem('medu-users');
      if (users) usersDB = JSON.parse(users);
      const cases = localStorage.getItem('medu-cases');
      if (cases) casesDB = JSON.parse(cases);
      const user = localStorage.getItem('medu-current-user');
      if (user) currentUser = JSON.parse(user);
    }

    // Dark mode toggle
    function toggleDarkMode() {
      if (document.body.classList.contains('light-mode')) {
        document.body.classList.remove('light-mode');
        localStorage.setItem('medu-darkmode', 'false');
      } else {
        document.body.classList.add('light-mode');
        localStorage.setItem('medu-darkmode', 'true');
      }
    }
    darkModeToggle.addEventListener('click', toggleDarkMode);
    // On load check darkmode setting
    if(localStorage.getItem('medu-darkmode') === 'true'){
      document.body.classList.add('light-mode');
    }

    // Sidebar toggle for mobile
    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('show');
    });

    // Navigation click handler
    function navClickHandler(e) {
      e.preventDefault();
      if (!e.target.classList.contains('nav-link')) return;
      let section = e.target.dataset.section;
      if (!section) return;
      if (section === 'admintools' && (!currentUser || currentUser.role !== 'admin')) {
        alert('Admin Tools are restricted.');
        return;
      }
      currentSection = section;
      updateNavActive();
      renderSection(section);
      if(window.innerWidth < 900) {
        sidebar.classList.remove('show');
      }
    }
    sidebar.addEventListener('click', navClickHandler);

    // Update nav active state
    function updateNavActive() {
      $all('.nav-link').forEach(link => {
        if (link.dataset.section === currentSection) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
    }

    // Format date/time nicely
    function formatDateTime(timestamp) {
      const d = new Date(timestamp);
      return d.toLocaleString();
    }

    // Get medal icon with glow class
    function getMedalIcon(type) {
      switch(type) {
        case 'bronze': return '<span class="medal-bronze" title="Bronze Medal">🥉</span>';
        case 'silver': return '<span class="medal-silver" title="Silver Medal">🥈</span>';
        case 'gold': return '<span class="medal-gold" title="Gold Medal">🥇</span>';
        default: return '';
      }
    }

    // Calculate user rank based on medals
    function calculateRank(user) {
      let totalMedals = (user.medals.bronze||0) + (user.medals.silver||0)*2 + (user.medals.gold||0)*3;
      if(totalMedals >= 15) return 'Platinum Medic';
      if(totalMedals >= 8) return 'Gold Medic';
      if(totalMedals >= 3) return 'Silver Medic';
      return 'Bronze Medic';
    }

    // Render login screen
    function renderLogin() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Welcome to MEDU Case Vault</h2>
          <div class="card" style="max-width:400px; margin: 2rem auto;">
            <form id="loginForm">
              <label for="username">Username</label>
              <input type="text" id="username" placeholder="Enter username" required autocomplete="off"/>
              <label for="password">Password</label>
              <input type="password" id="password" placeholder="Enter password" required autocomplete="off"/>
              <button type="submit">Login</button>
              <p style="margin-top:1rem; font-size: 0.9rem; color: var(--accent-blue-light);">
                Not registered? <a href="#" id="showRegister">Register here</a>
              </p>
            </form>
          </div>
        </section>
      `;

      $('#showRegister').addEventListener('click', (e) => {
        e.preventDefault();
        renderRegister();
      });

      $('#loginForm').addEventListener('submit', e => {
        e.preventDefault();
        const username = $('#username').value.trim();
        const password = $('#password').value.trim();
        if(!username || !password){
          alert('Please fill both username and password.');
          return;
        }
        if(usersDB[username] && usersDB[username].password === password) {
          currentUser = {...usersDB[username]};
          currentUser.username = username;
          alert(`Welcome back, ${username}!`);
          postLoginSetup();
        } else {
          alert('Invalid credentials.');
        }
      });
    }

    // Render registration form
    function renderRegister() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Register New Account</h2>
          <div class="card" style="max-width:400px; margin: 2rem auto;">
            <form id="registerForm">
              <label for="regUsername">Username</label>
              <input type="text" id="regUsername" placeholder="Choose username" required autocomplete="off" />
              <label for="regPassword">Password</label>
              <input type="password" id="regPassword" placeholder="Choose password" required autocomplete="off" />
              <label for="regConfirm">Confirm Password</label>
              <input type="password" id="regConfirm" placeholder="Confirm password" required autocomplete="off" />
              <button type="submit">Register</button>
              <p style="margin-top:1rem; font-size: 0.9rem; color: var(--accent-blue-light);">
                Already have an account? <a href="#" id="showLogin">Login here</a>
              </p>
            </form>
          </div>
        </section>
      `;

      $('#showLogin').addEventListener('click', (e) => {
        e.preventDefault();
        renderLogin();
      });

      $('#registerForm').addEventListener('submit', e => {
        e.preventDefault();
        const username = $('#regUsername').value.trim();
        const password = $('#regPassword').value.trim();
        const confirm = $('#regConfirm').value.trim();
        if(!username || !password || !confirm){
          alert('Fill all fields.');
          return;
        }
        if(password !== confirm){
          alert('Passwords do not match.');
          return;
        }
        if(usersDB[username]){
          alert('Username already taken.');
          return;
        }
        usersDB[username] = {
          username,
          password,
          role: 'player',
          medals: {bronze:0, silver:0, gold:0},
          rank: 'Bronze Medic',
          completedCases: []
        };
        alert('Registration successful! Please login.');
        saveToStorage();
        renderLogin();
      });
    }

    // Post-login setup: show nav, content, admin link if admin
    function postLoginSetup() {
      saveToStorage();
      // Show admin link if user is admin
      if(currentUser.role === 'admin'){
        adminToolsLink.style.display = 'block';
      } else {
        adminToolsLink.style.display = 'none';
      }
      renderSection('home');
      updateNavActive();
    }

    // Render Home Section
    function renderHome() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Welcome to the MEDU Case Vault</h2>
          <p>The ultimate medical roleplay and clinical learning simulation platform under SWM | Medical Education Department.</p>
          <div class="card">
            <h3>Quick Actions</h3>
            <button id="btnEnterVault">Enter Vault</button>
            <button id="btnLogout" style="background: var(--danger); margin-left:1rem;">Logout</button>
          </div>
          <div class="callout">
            🔎 <strong>Tip:</strong> Use the navigation to explore games, shadow cases, anatomy explorer, and more!
          </div>
        </section>
      `;

      $('#btnEnterVault').addEventListener('click', () => {
        renderSection('games');
        updateNavActive();
      });

      $('#btnLogout').addEventListener('click', () => {
        if(confirm('Are you sure you want to logout?')){
          currentUser = null;
          saveToStorage();
          adminToolsLink.style.display = 'none';
          renderLogin();
        }
      });
    }

    // Render Games Section (All games descriptions + Start buttons)
    function renderGames() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Games</h2>
          <p>Select a game to start playing medical cases and challenges.</p>

          <div class="card" data-game="diagnosis-duel">
            <h3>🧠 Diagnosis Duel (1v1 Competitive)</h3>
            <p>Compete with another player to diagnose the same case fastest and most accurately. Rankings from Bronze to Platinum Medic.</p>
            <button class="start-game-btn" data-game="diagnosis-duel">Start Diagnosis Duel</button>
          </div>

          <div class="card" data-game="er-escape">
            <h3>🚨 ER Escape Room</h3>
            <p>Virtual emergency room scenarios where you must solve cases to escape. High pressure, high stakes.</p>
            <button class="start-game-btn" data-game="er-escape">Start ER Escape Room</button>
          </div>

          <div class="card" data-game="anatomy-match">
            <h3>🧪 Anatomy Puzzle Match</h3>
            <p>Match organs and functions to solve anatomy puzzles and unlock medical knowledge badges.</p>
            <button class="start-game-btn" data-game="anatomy-match">Start Anatomy Puzzle Match</button>
          </div>

          <div class="card" data-game="case-creator">
            <h3>📄 Case Creator Game</h3>
            <p>Create custom medical cases and challenge others to solve your puzzles.</p>
            <button class="start-game-btn" data-game="case-creator">Start Case Creator Game</button>
          </div>
        </section>
      `;

      $all('.start-game-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const game = btn.dataset.game;
          startGame(game);
        });
      });
    }

    // Start a game (Placeholder logic)
    function startGame(game) {
      switch(game){
        case 'diagnosis-duel':
          renderDiagnosisDuel();
          break;
        case 'er-escape':
          renderEREscapeRoom();
          break;
        case 'anatomy-match':
          renderAnatomyPuzzleMatch();
          break;
        case 'case-creator':
          if(currentUser.role === 'admin'){
            renderCaseCreator();
          } else {
            alert('Case Creator is restricted to Admins only.');
            renderGames();
          }
          break;
        default:
          alert('Game not implemented yet.');
          renderGames();
      }
    }

    // Placeholder: Diagnosis Duel
    function renderDiagnosisDuel() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">🧠 Diagnosis Duel</h2>
          <p>This is a simulated competitive diagnosis game.</p>
          <p><em>(Placeholder for 1v1 competitive logic, matchmaking, timer, and case solving.)</em></p>
          <button id="backToGames">Back to Games</button>
        </section>
      `;
      $('#backToGames').addEventListener('click', () => {
        renderGames();
      });
    }

    // Placeholder: ER Escape Room
    function renderEREscapeRoom() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">🚨 ER Escape Room</h2>
          <p>Navigate through an emergency room and solve cases to escape.</p>
          <p><em>(Placeholder for ER escape room simulation.)</em></p>
          <button id="backToGames">Back to Games</button>
        </section>
      `;
      $('#backToGames').addEventListener('click', () => {
        renderGames();
      });
    }

    // Placeholder: Anatomy Puzzle Match
    function renderAnatomyPuzzleMatch() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">🧪 Anatomy Puzzle Match</h2>
          <p>Match organs with their functions in an engaging puzzle.</p>
          <p><em>(Placeholder for anatomy puzzle match.)</em></p>
          <button id="backToGames">Back to Games</button>
        </section>
      `;
      $('#backToGames').addEventListener('click', () => {
        renderGames();
      });
    }

    // Admin-only: Case Creator Game
    function renderCaseCreator() {
      let caseOptions = '';
      Object.values(casesDB).forEach(c => {
        caseOptions += `<option value="${c.id}">${c.title} [${c.status}]</option>`;
      });

      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">📄 Case Creator (Admin)</h2>
          <form id="caseCreatorForm" class="card" style="max-width:600px;">
            <label for="caseTitle">Case Title</label>
            <input type="text" id="caseTitle" placeholder="Enter case title" required />
            
            <label for="caseDescription">Description</label>
            <textarea id="caseDescription" rows="4" placeholder="Enter case description" required></textarea>

            <label for="caseGame">Game</label>
            <select id="caseGame" required>
              <option value="" disabled selected>Select game</option>
              <option value="Diagnosis Duel">Diagnosis Duel</option>
              <option value="ER Escape Room">ER Escape Room</option>
              <option value="Anatomy Puzzle Match">Anatomy Puzzle Match</option>
              <option value="Case Creator Game">Case Creator Game</option>
            </select>

            <label for="caseDifficulty">Difficulty</label>
            <select id="caseDifficulty" required>
              <option value="" disabled selected>Select difficulty</option>
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>

            <button type="submit">Create / Update Case</button>
          </form>

          <div class="card" style="margin-top:2rem;">
            <h3>Existing Cases</h3>
            <select id="selectExistingCase">
              <option value="" selected disabled>Select a case to edit</option>
              ${caseOptions}
            </select>
            <button id="deleteCaseBtn" style="background: var(--danger); margin-top:1rem;">Delete Selected Case</button>
          </div>

          <button id="backToGames" style="margin-top: 2rem;">Back to Games</button>
        </section>
      `;

      $('#caseCreatorForm').addEventListener('submit', e => {
        e.preventDefault();
        const title = $('#caseTitle').value.trim();
        const description = $('#caseDescription').value.trim();
        const game = $('#caseGame').value;
        const difficulty = $('#caseDifficulty').value;
        if(!title || !description || !game || !difficulty){
          alert('Fill all fields.');
          return;
        }
        // Check if editing existing
        const selectedCaseId = $('#selectExistingCase').value;
        if(selectedCaseId) {
          casesDB[selectedCaseId].title = title;
          casesDB[selectedCaseId].description = description;
          casesDB[selectedCaseId].game = game;
          casesDB[selectedCaseId].difficulty = difficulty;
          alert('Case updated.');
        } else {
          // New case id
          const newId = `case${Date.now()}`;
          casesDB[newId] = {
            id: newId,
            title,
            description,
            game,
            status: 'open',
            createdBy: currentUser.username,
            difficulty,
          };
          alert('Case created.');
          // Refresh select options
          renderCaseCreator();
          return;
        }
        saveToStorage();
      });

      $('#selectExistingCase').addEventListener('change', e => {
        const caseId = e.target.value;
        if(!caseId) return;
        const selectedCase = casesDB[caseId];
        if(selectedCase){
          $('#caseTitle').value = selectedCase.title;
          $('#caseDescription').value = selectedCase.description;
          $('#caseGame').value = selectedCase.game;
          $('#caseDifficulty').value = selectedCase.difficulty;
        }
      });

      $('#deleteCaseBtn').addEventListener('click', () => {
        const selectedCaseId = $('#selectExistingCase').value;
        if(!selectedCaseId){
          alert('Select a case to delete.');
          return;
        }
        if(confirm('Are you sure you want to delete this case? This action cannot be undone.')){
          delete casesDB[selectedCaseId];
          alert('Case deleted.');
          saveToStorage();
          renderCaseCreator();
        }
      });

      $('#backToGames').addEventListener('click', () => {
        renderGames();
      });
    }

    // Shadow Cases Section
    function renderShadowCases() {
      const shadowCases = Object.values(casesDB).filter(c => c.status === 'open');
      let listHTML = '';
      if(shadowCases.length === 0) listHTML = '<p>No active shadow cases at the moment.</p>';
      else {
        shadowCases.forEach(c => {
          listHTML += `
            <div class="card">
              <h3>${c.title} <small style="color:#ccc; font-size:0.9rem;">[${c.difficulty}]</small></h3>
              <p>${c.description}</p>
              <p><strong>Game:</strong> ${c.game}</p>
              <button class="start-case-btn" data-caseid="${c.id}">Start Case</button>
            </div>
          `;
        });
      }
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Shadow Cases</h2>
          ${listHTML}
          <button id="backToGames" style="margin-top: 1rem;">Back to Games</button>
        </section>
      `;

      $all('.start-case-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const caseId = btn.dataset.caseid;
          if(caseId) {
            startCase(caseId);
          }
        });
      });
      $('#backToGames').addEventListener('click', () => {
        renderGames();
      });
    }

    // Start a specific case
    function startCase(caseId) {
      const c = casesDB[caseId];
      if(!c){
        alert('Case not found.');
        renderShadowCases();
        return;
      }
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Case: ${c.title}</h2>
          <p><strong>Game:</strong> ${c.game}</p>
          <p>${c.description}</p>
          <button id="btnSolveCase">Solve Case</button>
          <button id="btnBackCases" style="margin-left:1rem;">Back to Cases</button>
        </section>
      `;

      $('#btnSolveCase').addEventListener('click', () => {
        // Simulate solving with a simple success
        alert('Congratulations! You solved the case.');
        // Update user progress
        if(!currentUser.completedCases.includes(caseId)){
          currentUser.completedCases.push(caseId);
          // Award medal based on difficulty
          switch(c.difficulty) {
            case 'easy': currentUser.medals.bronze++; break;
            case 'medium': currentUser.medals.silver++; break;
            case 'hard': currentUser.medals.gold++; break;
          }
          currentUser.rank = calculateRank(currentUser);
          usersDB[currentUser.username] = {...currentUser};
          saveToStorage();
        }
        renderShadowCases();
      });

      $('#btnBackCases').addEventListener('click', () => {
        renderShadowCases();
      });
    }

    // Anatomy Explorer Section
    function renderAnatomyExplorer() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Anatomy Explorer</h2>
          <p>Explore detailed anatomical diagrams and test your knowledge.</p>
          <p><em>(Placeholder for interactive anatomy explorer with puzzles and quizzes.)</em></p>
          <button id="backToGames">Back to Games</button>
        </section>
      `;
      $('#backToGames').addEventListener('click', () => {
        renderGames();
      });
    }

    // Leaderboard Section
    function renderLeaderboard() {
      // Build sorted leaderboard
      const sortedUsers = Object.values(usersDB).sort((a,b) => {
        const aScore = (a.medals.gold||0)*3 + (a.medals.silver||0)*2 + (a.medals.bronze||0);
        const bScore = (b.medals.gold||0)*3 + (b.medals.silver||0)*2 + (b.medals.bronze||0);
        return bScore - aScore;
      });

      let tableRows = '';
      sortedUsers.forEach((u,i) => {
        tableRows += `
          <tr>
            <td>${i+1}</td>
            <td>${u.username}</td>
            <td>${getMedalIcon('gold')} ${u.medals.gold || 0}</td>
            <td>${getMedalIcon('silver')} ${u.medals.silver || 0}</td>
            <td>${getMedalIcon('bronze')} ${u.medals.bronze || 0}</td>
            <td>${u.rank || 'Bronze Medic'}</td>
          </tr>
        `;
      });

      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Leaderboard</h2>
          <table class="leaderboard">
            <thead>
              <tr>
                <th>#</th>
                <th>Username</th>
                <th>Gold Medals</th>
                <th>Silver Medals</th>
                <th>Bronze Medals</th>
                <th>Rank</th>
              </tr>
            </thead>
            <tbody>
              ${tableRows}
            </tbody>
          </table>
          <button id="backToHome" style="margin-top: 1rem;">Back to Home</button>
        </section>
      `;

      $('#backToHome').addEventListener('click', () => {
        renderHome();
      });
    }

    // Archives Section
    function renderArchives() {
      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Archives</h2>
          <p>Archived cases and past events will be displayed here.</p>
          <p><em>(Placeholder for archive records.)</em></p>
          <button id="backToHome" style="margin-top: 1rem;">Back to Home</button>
        </section>
      `;
      $('#backToHome').addEventListener('click', () => {
        renderHome();
      });
    }

    // Admin Tools Section (Only visible if admin)
    function renderAdminTools() {
      // List users with management tools
      let userListHTML = '';
      Object.values(usersDB).forEach(u => {
        userListHTML += `
          <div class="card" style="margin-bottom:0.75rem; display:flex; justify-content:space-between; align-items:center;">
            <div>
              <strong>${u.username}</strong> (${u.role})
              <br/>
              Medals: ${getMedalIcon('gold')} ${u.medals.gold || 0} | ${getMedalIcon('silver')} ${u.medals.silver || 0} | ${getMedalIcon('bronze')} ${u.medals.bronze || 0}
              <br/>
              Rank: ${u.rank || 'Bronze Medic'}
            </div>
            <div>
              <button class="btn-promote" data-user="${u.username}" title="Promote Medal">🏅 Promote</button>
              <button class="btn-demote" data-user="${u.username}" title="Demote Medal">🔻 Demote</button>
              <button class="btn-delete-user" data-user="${u.username}" title="Delete User" style="background: var(--danger);">❌</button>
            </div>
          </div>
        `;
      });

      mainContent.innerHTML = `
        <section class="fade-in">
          <h2 class="section-title">Admin Tools</h2>
          <h3>User Management</h3>
          ${userListHTML}
          <button id="addUserBtn" style="margin-top: 1rem;">Add New User</button>
          <button id="backToHome" style="margin-top: 2rem;">Back to Home</button>
        </section>
      `;

      $all('.btn-promote').forEach(btn => {
        btn.addEventListener('click', () => {
          const username = btn.dataset.user;
          promoteUser(username);
        });
      });
      $all('.btn-demote').forEach(btn => {
        btn.addEventListener('click', () => {
          const username = btn.dataset.user;
          demoteUser(username);
        });
      });
      $all('.btn-delete-user').forEach(btn => {
        btn.addEventListener('click', () => {
          const username = btn.dataset.user;
          if(username === currentUser.username) {
            alert('You cannot delete yourself.');
            return;
          }
          if(confirm(`Are you sure you want to delete user '${username}'?`)){
            delete usersDB[username];
            saveToStorage();
            renderAdminTools();
          }
        });
      });

      $('#addUserBtn').addEventListener('click', () => {
        promptAddUser();
      });
      $('#backToHome').addEventListener('click', () => {
        renderHome();
      });
    }

    // Admin: Promote user medals
    function promoteUser(username) {
      const user = usersDB[username];
      if(!user){
        alert('User not found.');
        return;
      }
      // Promote from bronze -> silver -> gold (max)
      if(user.medals.bronze < 10){
        user.medals.bronze++;
      } else if(user.medals.silver < 10){
        user.medals.silver++;
      } else if(user.medals.gold < 10){
        user.medals.gold++;
      } else {
        alert('User already has maximum medals.');
        return;
      }
      user.rank = calculateRank(user);
      usersDB[username] = user;
      saveToStorage();
      alert(`${username} promoted!`);
      renderAdminTools();
    }

    // Admin: Demote user medals
    function demoteUser(username) {
      const user = usersDB[username];
      if(!user){
        alert('User not found.');
        return;
      }
      // Demote in reverse: gold -> silver -> bronze
      if(user.medals.gold > 0){
        user.medals.gold--;
      } else if(user.medals.silver > 0){
        user.medals.silver--;
      } else if(user.medals.bronze > 0){
        user.medals.bronze--;
      } else {
        alert('User has no medals to demote.');
        return;
      }
      user.rank = calculateRank(user);
      usersDB[username] = user;
      saveToStorage();
      alert(`${username} demoted.`);
      renderAdminTools();
    }

    // Admin: Prompt add user modal
    function promptAddUser() {
      showModal(`
        <h3>Add New User</h3>
        <form id="addUserForm">
          <label for="newUsername">Username</label>
          <input type="text" id="newUsername" required />
          <label for="newPassword">Password</label>
          <input type="password" id="newPassword" required />
          <label for="newRole">Role</label>
          <select id="newRole" required>
            <option value="player" selected>Player</option>
            <option value="admin">Admin</option>
          </select>
          <button type="submit">Add User</button>
          <button type="button" id="cancelAddUser">Cancel</button>
        </form>
      `);

      $('#addUserForm').addEventListener('submit', e => {
        e.preventDefault();
        const username = $('#newUsername').value.trim();
        const password = $('#newPassword').value.trim();
        const role = $('#newRole').value;
        if(!username || !password) {
          alert('Fill all fields.');
          return;
        }
        if(usersDB[username]){
          alert('Username already exists.');
          return;
        }
        usersDB[username] = {
          username,
          password,
          role,
          medals: {bronze:0, silver:0, gold:0},
          rank: 'Bronze Medic',
          completedCases: []
        };
        saveToStorage();
        alert('User added.');
        closeModal();
        renderAdminTools();
      });

      $('#cancelAddUser').addEventListener('click', () => {
        closeModal();
      });
    }

    // Initial load
    loadFromStorage();

    if(currentUser){
      postLoginSetup();
    } else {
      renderLogin();
    }
  })();
</script>

</body>
</html>
